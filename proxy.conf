server {
     listen 8080;
     server_name avalanche.ca;
     return 301 $scheme://www.avalanche.ca$request_uri;
}

server {
    listen 8080;
    client_max_body_size 20M;
    server_name www.avalanche.ca;

    location /assets {
        rewrite /assets/$ /index.html break;
        rewrite /assets$ /index.html break;
        rewrite /assets/(.*) /$1  break;
        proxy_pass            https://ac-assets.s3.amazonaws.com;
    }

    location /fxresources {
        rewrite /fxresources/(.*) /$1 break;
        proxy_pass       https://avalancheca-assets.s3.amazonaws.com;
        #proxy_set_header Host $host;
    }

    location /membership{
        return 303 https://membership.avalanche.ca/np/clients/cac/membershipJoin.jsp;
    }

    location /forums{
        return 403;
    }

    location /Forums{
        return 403;
    }

    location /caa{
        return 301 http://www.avalancheassociation.ca;
    }

    location / {
        rewrite \/cac\/bulletins\/latest\/(.*) /forecasts/$1 permanent;
        rewrite \/cac\/bulletins\/latest$ / permanent;
        rewrite \/cac\/forecasts(.*) / permanent;
        rewrite \/cac(.*)$ $1 permanent;
        rewrite \/caf(.*)$ foundation/$1 permanent;

        proxy_pass  http://nodejs;
        proxy_set_header   Connection "";
        proxy_http_version 1.1;
        proxy_set_header        Host            $host;
        proxy_set_header        X-Real-IP       $remote_addr;
        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
    }

}
